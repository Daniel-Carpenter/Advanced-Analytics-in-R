---
title:    "ISE 5103 Intelligent Data Analytics"
subtitle: "Homework 6 - Modeling Competition"
author:   "Daniel Carpenter, Sonaxy Mohanty, & Zachary Knepp"
date:     "October 2022"
output: 
  pdf_document:
    toc: true
    toc_depth: 3
    highlight: arrow
    latex_engine: xelatex
  # github_document:
  #   toc: yes
  #   toc_depth: 2
urlcolor: blue
cache: true
fig.width: 7
fig.height: 5
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

\newpage

```{r echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}
# Packages --------

# Data Wrangling
library(tidyverse)
library(skimr)
library(lubridate) # dates

# Modeling
library(MASS)
library(caret) # Modeling variants like SVM
library(earth) # Modeling with Mars
library(pls)   # Modeling with PLS
library(glmnet) # Modeling with LASSO

# Aesthetics
library(knitr)
library(cowplot)  # multiple ggplots on one plot with plot_grid()
library(scales)
library(kableExtra)
library(ggplot2)

#Hold-out Validation
library(caTools)

#Data Correlation
library(GGally)
library(regclass)

#RMSE Calculation
library(Metrics)

#p-value for OLS model
library(broom)

#ncvTest
library(car)
```

## General Data Prep
> For general data preparation, please see conceptual steps below. See `.rmd` file for detailed code.

### Read Training Data
Clean data to ensure each read variable has the correct data type (factor, numeric, Date, etc.)
```{r, echo=FALSE}
# Convert all character data to factor
df.train <- read.csv('Train.csv', stringsAsFactors = TRUE)

# convert the ""'s to NA
df.train[df.train == ""] <- NA

# Clean data
df.train <- df.train %>% 
  
  # Ensure boolean variables are numeric
  mutate(adwordsClickInfo.isVideoAd = as.numeric(adwordsClickInfo.isVideoAd) ) %>%
  
  # Make sure dates are dates
  mutate(date = as.Date(date),
         visitStartTime = as_datetime(visitStartTime)
         ) %>%

  # Ensure factor are factors
  mutate(custId       = as.factor(custId),
         sessionId    = as.factor(sessionId),
         isMobile     = as.factor(isMobile),
         isTrueDirect = as.factor(isTrueDirect),
         newVisits    = as.factor(if_else(is.na(newVisits), 0, 1) ),
         bounces      = as.factor(if_else(is.na(bounces),   0, 1)   ),
         adwordsClickInfo.page      = as.factor(adwordsClickInfo.page),
         adwordsClickInfo.isVideoAd = as.factor(adwordsClickInfo.isVideoAd)
         )
```

### Create `numeric` and `factor` `data frames`

Make data set of `numeric` variables called `df.train.numeric`
```{r, echo=FALSE}
df.train.numeric <- df.train %>%

  # selecting all the numeric data
  dplyr::select_if(is.numeric) %>%

  # converting the data frame to tibble
  as_tibble()
```

Make data set of `factor` variables called `df.train.factor`
```{r, echo=FALSE}
df.train.factor <- df.train %>%

  #selecting all the numeric data
  dplyr::select_if(is.factor) %>%

  #converting the data frame to tibble
  as_tibble()
```


## `2 (i)` - Data Understanding
> Create a data quality report of `numeric` and `factor` data

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Function to remove any columns with NA
removeColsWithNA <- function(df) {
  return( df[ , colSums(is.na(df)) == 0] )
}

# Create Comprehensive data report using skimr package
# This is done a bit piece-wise because PDF latex does not like the skimr package
# Very much. So Instead of printing `skim(df)`, I have to pull the contents manually
# Unfortunately. This is not an issue with html typically.
dataReport <- skim(df.train) %>%
  rename_all(~str_replace(.,"skim_","")) %>%
  arrange(type, desc(complete_rate) ) # sort data 

# Filter to the class types
dataReport.numeric <- dataReport %>% filter(type == 'numeric') # numeric data
dataReport.factor  <- dataReport %>% filter(type == 'factor' ) # factor  data

# Remove columns that do not apply to this type of data -----------------------

## numeric data
dataReport.numeric <- removeColsWithNA(dataReport.numeric)  %>%
  
  # Clean column names by removing numeric prefix, 
  rename_all(~str_replace(.,"numeric.","")) 
  
## factor  data
dataReport.factor  <- removeColsWithNA(dataReport.factor ) %>%

  # Clean column names by removing factor  prefix
  rename_all(~str_replace(.,"factor.",""))  
```

### Numeric Data Quality Report

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Get summary of data frame
data.frame(Num_Numeric_Variables = ncol(df.train.numeric),
           Total_Observations    = nrow(df.train.numeric) ) %>%
  kable()
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Now see individual column statistics

# Set up options for Display the reports
options(skimr_strip_metadata = FALSE)
options(digits=2)
options(scipen=99)

# show report
dataReport.numeric %>% 
  dplyr::select(-type, -hist) %>%
  kable() %>% kable_styling(font_size=7, latex_options = 'HOLD_position') # numeric data

```

\newpage

### Factor Data Quality Report
* Appears that few people use website from the ads, which cause many null values.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Get summary of data frame
data.frame(Num_Factor_Variables = ncol(df.train),
           Total_Observations   = nrow(df.train) ) %>%
  kable()
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
dataReport.factor  %>% 
  dplyr::select(-type) %>% 
  kable() %>% kable_styling(font_size=7, latex_options = 'HOLD_position')  # factor  data
```
